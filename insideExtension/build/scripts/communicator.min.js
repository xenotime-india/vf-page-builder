function Communicator(){this.handlers={},this.addListeners()}Communicator.prototype.addListeners=function(){chrome.extension.onRequest.addListener(function(n,o,t){o.tab&&communicator.handleMessage(n,o.tab.id,t)}),chrome.windows.onRemoved.addListener(function(n){for(var o in communicator.handlers){var t,e=communicator.handlers[o].length,i=[];for(t=0;t<e;t++)communicator.handlers[o][t].win_id==n&&i.push(communicator.handlers[o][t].handler);for(t=0;t<i.length;t++)communicator.unregisterHandler(o,i[t])}})},Communicator.prototype.registerHandler=function(n,o,t){n in this.handlers||(this.handlers[n]=[]),this.handlers[n].push({handler:o,win_id:t})},Communicator.prototype.unregisterHandler=function(n,o){if(n in this.handlers)for(var t=0;t<this.handlers[n].length;t++)if(this.handlers[n][t].handler==o){this.handlers[n].splice(t,1);break}},Communicator.prototype.handleMessage=function(n,o,t){n.topic in this.handlers?chrome.tabs.get(o,function(e){e&&communicator.handlers[n.topic].forEach(function(i){return i.win_id&&i.win_id==e.windowId?void i.handler(n.data,o,t):(i.handler(n.data,o),void(t&&t()))})}):console.warn("Communicator: unknown topic "+n.topic)},Communicator.prototype.postMessage=function(n,o,t,e,i){chrome.tabs.sendRequest(t,{topic:n,data:o,_frame:i},e)},Communicator.prototype.sendMessage=function(n,o,t,e){return new Promise(function(i,a){chrome.tabs.sendMessage(t,{topic:n,data:o,_frame:e},i)})},Communicator.prototype.broadcastMessage=function(n,o,t){t?chrome.tabs.getAllInWindow(t,function(t){t&&t.forEach(function(t){chrome.tabs.sendRequest(t.id,{topic:n,data:o},function(){})})}):chrome.windows.getLastFocused(function(t){t.tabs.forEach(function(t){chrome.tabs.sendRequest(t.id,{topic:n,data:o},function(){})})})};var communicator=new Communicator;
//# sourceMappingURL=communicator.min.js.map
