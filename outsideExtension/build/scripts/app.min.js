var apiVersion="41.0",requestMetadata=[],allProfiles={},requestSqlData=[{type:"ApexClass",table:"ApexClass_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexPage",table:"ApexPage_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexTrigger",table:"ApexTrigger_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"ApexComponent",table:"ApexComponent_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"StaticResource",table:"StaticResource_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"WebLink",table:"WebLink_tb",soqlFields:"Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate, PageOrSobjectType",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","PageOrSobjectType","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:[3,2]},{type:"Dashboard",table:"Dashboard_tb",soqlFields:"Id, Title, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Title","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:2},{type:"Report",table:"Report_tb",soqlFields:"Id, Name, DeveloperName,LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","Name","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:3},{type:"RecordType",table:"RecordType_tb",soqlFields:"Id, SobjectType, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate, DeveloperName",soqlWhere:"NamespacePrefix = null",fields:["Select","Id","SobjectType","Name","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:[2,4]},{type:"ActionLinkGroupTemplate",table:"ActionLinkGroupTemplate_tb",soqlFields:"Id, MasterLabel, DeveloperName, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate",soqlWhere:"Id != null",fields:["Select","Id","MasterLabel","DeveloperName","LastModifiedDate","LastModifiedBy","CreatedDate","CreatedBy"],apiFieldIndex:3}],filterBy="LastModifiedDate",filterByMetadata="lastModifiedDate",sforce=new jsforce.Connection({serverUrl:getServerURL(),sessionId:__getCookie("sid")});function changefilterMode(e,a){filterBy=e,filterByMetadata=a}function getServerURL(){var e=window.location.href.split("/");return e[0]+"//"+e[2]}function addRow(e,a,t){jQuery(t).append("<tr/>"),a.map(function(a){return"Select"==a?jQuery('<td><span aria-hidden="true" class="glyphicon glyphicon-unchecked"></span></td>'):"null"==e[a]||null==e[a]?jQuery("<td></td>"):isDate(e[a])?jQuery("<td>"+moment(new Date(e[a])).format("YYYY-MM-DD")+"<br/>("+moment(new Date(e[a])).fromNow()+")</td>"):"string"==typeof e[a]?jQuery("<td>"+e[a]+"</td>"):jQuery("<td>"+e[a].Name+"</td>")}).forEach(function(e){jQuery(t).find("tr:last").append(e)})}function createPanel(e,a,t){jQuery(t).append('<li><a href="#'+jQuery(a).attr("Id")+'-tab" role="tab" data-toggle="tab">'+e+"</a></li>");var r=jQuery('<div class="tab-pane" id="'+jQuery(a).attr("Id")+'-tab"/>'),i=jQuery('<div class="panel panel-default"/>');return jQuery(i).append('<div class="panel-heading"> '+e+"</div>"),jQuery(i).append('<div class="panel-body"></div>'),jQuery(i).find(".panel-body").append(jQuery(a)),jQuery(r).append(jQuery(i)),jQuery(r)}function createTable(e,a){var t=jQuery('<table id="'+a+'" cellpadding="0" border="0" class="table table-striped table-bordered" cellspacing="0" width="100%"></table>');for(jQuery(t).append("<thead></thead>"),jQuery(t).append("<tbody></tbody>"),jQuery(t).find("thead").append("<tr/>"),i=0;i<e.length;i++)"Select"==e[i]?jQuery(t).find("tr:last").append('<td><input type="checkbox" onclick="selectAll(this,\''+a+"','')\"/></td>"):jQuery(t).find("thead>tr").append("<th>"+e[i]+"</th>");return jQuery(t)}function selectAll(e,a,t){var r=(""!=a?jQuery("#"+a).dataTable():jQuery(t).dataTable()).fnGetNodes();jQuery(r).each(function(){""==e||jQuery(e).is(":checked")?(jQuery(this).addClass("selected"),jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check")):(jQuery(this).removeClass("selected"),jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked"))})}function globalSelectAll(){requestMetadata.forEach(function(e,a){selectAll("","",jQuery("#"+e.table))}),requestSqlData.forEach(function(e,a){selectAll("","",jQuery("#"+e.table))})}function globalUnSelectAll(){requestMetadata.forEach(function(e,a){selectAll(" ","",jQuery("#"+e.table))}),requestSqlData.forEach(function(e,a){selectAll(" ","",jQuery("#"+e.table))})}function maketypeblock(e,a,t){var r="";jQuery(e).DataTable().rows(".selected").data().length>0&&(r+="\n    <types>",r+=jQuery(e).DataTable().rows(".selected").data().map(function(e){return"number"==typeof a?""!=e[a]&&"null"!=e[a]&&null!=e[a]?"\n        <members>"+e[a]+"</members>":"":Array.isArray(a)?"\n        <members>"+a.map(function(a){return e[a]}).join(".")+"</members>":""}).reduce(function(e,a){return a+e}),r+=" \n       <name>"+t+"</name>",r+=" \n   </types>");return r}function makeobjectToRetrive(e,a,t){var r;return jQuery(e).DataTable().rows(".selected").data().length>0&&(r={name:t,members:[]},jQuery(jQuery(e).DataTable().rows(".selected").data()).each(function(){if("number"==typeof a)""!=jQuery(this)[a]&&"null"!=jQuery(this)[a]&&null!=jQuery(this)[a]&&r.members.push(jQuery(this)[a]);else for(i=0;i<a.length;i++){var e="";""!=jQuery(this)[a[i]]&&"null"!=jQuery(this)[a[i]]&&null!=jQuery(this)[a[i]]&&(i!=a.length-1?e+=jQuery(this)[a[i]]+".":e+=jQuery(this)[a[i]]),r.members.push(e)}})),r}function getPackage(){showLoading();var e=[];requestMetadata.forEach(function(a,t){var r=makeobjectToRetrive(jQuery("#"+a.table),a.apiFieldIndex,a.type);void 0!==r&&e.push(r)}),requestSqlData.forEach(function(a,t){var r=makeobjectToRetrive(jQuery("#"+a.table),a.apiFieldIndex,a.type);void 0!==r&&e.push(r)}),e.length>0?sforce.metadata.retrieve({unpackaged:{types:e,version:apiVersion}}).complete(function(e,a){e&&console.error(e),console.log("ready for download.."),location.href="data:application/zip;base64,"+a.zipFile,hideLoading()}):(alert("No Resource selected..."),hideLoading())}function deploy(){alert("Coming Sooooon.")}function startChangeSetWorker(){var e=jQuery("#changeSetName").val(),a=jQuery("#changeSetDescription").val();if(e.trim().length>0){jQuery("#changeSetDialog").modal("hide");var t=[],r={name:"Profile",members:[]};requestMetadata.forEach(function(e,a){var i;"Profile"!=e.type?void 0!==(i=makeobjectToRetrive(jQuery("#"+e.table),1,e.type))&&t.push(i):void 0!==(i=makeobjectToRetrive(jQuery("#"+e.table),1,e.type))&&(i.members=i.members.map(function(e){return allProfiles[e]}),r=i)}),requestSqlData.forEach(function(e,a){var r=makeobjectToRetrive(jQuery("#"+e.table),1,e.type);void 0!==r&&t.push(r)}),localStorage.setItem("changeSetName",e),localStorage.setItem("changeSetDescription",a),localStorage.setItem("changeSet",JSON.stringify(t)),localStorage.setItem("profiles",JSON.stringify(r)),localStorage.setItem("processStatus","1"),localStorage.setItem("DoneChangeSet",JSON.stringify([])),window.open(window.location.protocol+"//"+window.location.host+"/changemgmt/createOutboundChangeSet.apexp?auto=1","_blank")}else jQuery("#changeSetName-form-group").addClass("has-error")}function createChangeSet(){var e=[];requestMetadata.forEach(function(a,t){if("Profile"!=a.type){var r=makeobjectToRetrive(jQuery("#"+a.table),1,a.type);void 0!==r&&e.push(r)}}),requestSqlData.forEach(function(a,t){var r=makeobjectToRetrive(jQuery("#"+a.table),1,a.type);void 0!==r&&e.push(r)}),e.length>0?jQuery("#changeSetDialog").modal({backdrop:"static",keyboard:!0}):ezBSAlert({messageText:"Please select resource before this action.",alertType:"danger"})}function loginUser(){var e=[];requestMetadata.forEach(function(a,t){var r=makeobjectToRetrive(jQuery("#"+a.table),a.apiFieldIndex,a.type);void 0!==r&&e.push(r)}),requestSqlData.forEach(function(a,t){var r=makeobjectToRetrive(jQuery("#"+a.table),a.apiFieldIndex,a.type);void 0!==r&&e.push(r)});sforce.metadata.retrieve({unpackaged:{types:e,version:apiVersion}}).complete(function(e,a){e&&console.error(e),console.log("ready for download..");var t=new Blob([a.zipFile],{type:"application/zip"});blobToBase64(t,function(e){var a=new File([e],"package.zip",{type:"application/zip"});console.log("File object created:",a);var t=new FormData;t.append("file",a),fetch("http://localhost:3000/upload",{method:"POST",body:t}).then(function(e){return e.json()}).then(console.log).catch(showError)})})}function generateXml(){var e='<?xml version="1.0" encoding="UTF-8"?>';e+='\n<Package xmlns="http://soap.sforce.com/2006/04/metadata">',requestMetadata.forEach(function(a,t){e+=maketypeblock(jQuery("#"+a.table),a.apiFieldIndex,a.type)}),requestSqlData.forEach(function(a,t){e+=maketypeblock(jQuery("#"+a.table),a.apiFieldIndex,a.type)}),e+="\n    <version>"+apiVersion+"</version>\n</Package>",jQuery("#xmlData").val(e),jQuery("#xmlDialog").modal()}function updateData(){showLoading(),setTimeout(function(){jQuery("#container").html(""),jQuery("#container-tab2").html(""),jQuery("#container-tab").html(""),workWithSOQL().then(function(){return workWithSessionStorageMetaData()}).then(function(){jQuery('#myTab a[href="#'+requestSqlData[0].type+'_tb-tab"]').tab("show"),hideLoading()}).catch(showError)},200)}function workWithSOQL(){var e="2015-12-10";""!=jQuery("#dateField").val()&&(e=convertDate(jQuery("#dateField").val()));var a=requestSqlData.map(function(a){var t="Select "+a.soqlFields+" From "+a.type+" where ";return t+=""!=e?filterBy+" >= "+e+" AND ":"",t+=" "+a.soqlWhere+" order by "+filterBy+" desc",sforce.query(t)});return Promise.all(a).then(function(e){return e.forEach(function(e,a){var t=e.records;if(t&&t.length>0){var r,i;i=createTable(requestSqlData[a].fields,requestSqlData[a].table),r=createPanel(requestSqlData[a].type,i,jQuery("#container-tab"));for(var o=0;o<t.length;o++)addRow(t[o],requestSqlData[a].fields,jQuery(i).find("tbody"));jQuery("#container").append(jQuery(r)),jQuery("#"+requestSqlData[a].table).DataTable({order:[[requestSqlData[a].fields.indexOf("LastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+requestSqlData[a].table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")})}}),Promise.resolve()}).catch(function(e){return Promise.reject(e)})}function workWithSessionStorageMetaData(){var e=["Select","id","fullName","fileName","lastModifiedDate","lastModifiedByName","createdDate","createdByName"],a=moment().add(-1,"M");return jQuery("#dateField").val()&&""!=jQuery("#dateField").val()?a=moment(jQuery("#dateField").val()):jQuery("#dateField").val(a.format("YYYY-MM-DD")),requestMetadata.forEach(function(t){var r=sessionStorage.getItem(t.type)?JSON.parse(sessionStorage.getItem(t.type)):null;if(r&&(!Array.isArray(r)||Array.isArray(r)&&r.length>0)){var i,o;o=createTable(e,t.table);var d=!1;Array.isArray(r)?r.forEach(function(t){"installed"!=t.manageableState&&moment(t[filterByMetadata]).isAfter(a)&&(addRow(t,e,jQuery(o).find("tbody")),d=!0)}):"installed"!=r.manageableState&&moment(r[filterByMetadata]).isAfter(a)&&(addRow(r,e,jQuery(o).find("tbody")),d=!0),d&&(i=createPanel(t.type,o,jQuery("#container-tab2")),jQuery("#container").append(jQuery(i)),jQuery("#"+t.table).DataTable({order:[[e.indexOf("lastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+t.table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")}))}}),Promise.resolve()}function workWithMetaData(){var e=["Select","id","fullName","fileName","lastModifiedDate","lastModifiedByName","createdDate","createdByName"],a=moment().add(-1,"M");jQuery("#dateField").val()&&""!=jQuery("#dateField").val()?a=moment(jQuery("#dateField").val()):jQuery("#dateField").val(a.format("YYYY-MM-DD"));var t=requestMetadata.map(function(e){var a=[{type:e.type}];return sforce.metadata.list(a,apiVersion)});return Promise.all(t).then(function(t){return t.forEach(function(t,r){if(t&&(!Array.isArray(t)||Array.isArray(t)&&t.length>0)){var i,o;sessionStorage.setItem(requestMetadata[r].type,JSON.stringify(t)),o=createTable(e,requestMetadata[r].table);var d=!1;Array.isArray(t)?t.forEach(function(t){"installed"!=t.manageableState&&moment(t[filterByMetadata]).isAfter(a)&&(addRow(t,e,jQuery(o).find("tbody")),d=!0)}):"installed"!=t.manageableState&&moment(t[filterByMetadata]).isAfter(a)&&(addRow(t,e,jQuery(o).find("tbody")),d=!0),d&&(i=createPanel(requestMetadata[r].type,o,jQuery("#container-tab2")),jQuery("#container").append(jQuery(i)),jQuery("#"+requestMetadata[r].table).DataTable({order:[[e.indexOf("lastModifiedDate"),"desc"]],iDisplayLength:100}),jQuery("#"+requestMetadata[r].table+" tbody").on("click","tr",function(){jQuery(this).toggleClass("selected"),jQuery(this).hasClass("selected")?jQuery(this).find("span.glyphicon").removeClass("glyphicon-unchecked").addClass("glyphicon-check"):jQuery(this).find("span.glyphicon").removeClass("glyphicon-check").addClass("glyphicon-unchecked")}))}else sessionStorage.removeItem(requestMetadata[r].type)}),Promise.resolve()}).catch(function(e){return Promise.reject(e)})}function convertDate(e){if(void 0!==e){var a=new Date(e),t=a.getFullYear(),r=a.getMonth()+1,i=a.getDate();return r<10&&(r="0"+r),i<10&&(i="0"+i),t+"-"+r+"-"+i+"T00:00:00Z"}return""}function showLoading(){jQuery("#status").hasClass("show")||(jQuery("#status").addClass("show"),jQuery("#status").show(),jQuery("#preloader").show())}function hideLoading(){jQuery("#status").removeClass("show"),jQuery("#status").hide(),jQuery("#preloader").hide()}jQuery(function(){showLoading(),jQuery("#dateField").val(moment().add(-1,"M").format("YYYY-MM-DD")),console.log("Ready for API fun!"),sforce.metadata.describe(apiVersion).then(function(e){return e.metadataObjects.forEach(function(e){e.childXmlNames&&e.childXmlNames.forEach(function(e){0==requestSqlData.filter(function(a){return a.type.toLowerCase()===e.toLowerCase()}).length&&requestMetadata.push({type:e,table:e+"_tb",apiFieldIndex:2})}),0==requestSqlData.filter(function(a){return a.type.toLowerCase()===e.xmlName.toLowerCase()}).length&&requestMetadata.push({type:e.xmlName,table:e.xmlName+"_tb",apiFieldIndex:2})}),requestMetadata=requestMetadata.sort(function(e,a){return e.type<a.type?-1:e.type>a.type?1:0})}).then(function(){return workWithSOQL()}).then(function(){return workWithMetaData()}).then(function(){return sforce.query("Select Id, Name, LastModifiedDate, LastModifiedBy.Name, CreatedBy.Name, CreatedDate From Profile")}).then(function(e){e.records.forEach(function(e){allProfiles[e.Id]=e.Name}),jQuery('#myTab a[href="#'+requestSqlData[0].type+'_tb-tab"]').tab("show"),hideLoading()}).catch(showError)});
//# sourceMappingURL=app.min.js.map
